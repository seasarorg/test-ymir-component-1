${database.allClassCopyright}package ${glPackageBaseCommonDBMeta};

#set ($myClassName = "${glDBMetaInterfaceName}")
import java.util.Map;
import java.util.List;
#if ($database.isMakeDBMetaJDBCSupport())
import java.sql.Connection;
#end

import ${glPackageBaseCommon}.${glEntityInterfaceName};
import ${glPackageBaseCommonHelper}.${glMapListStringName};
import ${glPackageBaseCommonHelper}.${glMapStringBuilderName};
import ${glPackageBaseCommonDBMetaInfo}.${glColumnInfoName};
import ${glPackageBaseCommonDBMetaInfo}.${glForeignInfoName};
import ${glPackageBaseCommonDBMetaInfo}.${glReferrerInfoName};
import ${glPackageBaseCommonDBMetaInfo}.${glRelationInfoName};
import ${glPackageBaseCommonDBMetaInfo}.${glUniqueInfoName};

/**
 * The interface of DB meta.
 * @author ${database.ClassAuthor}
 */
public interface ${myClassName} {

    // ===================================================================================
    //                                                                          Definition
    //                                                                          ==========
    /** Map-string map mark. */
    public static final String MAP_STRING_MAP_MARK = "map:";

    /** Map-string list mark. */
    public static final String MAP_STRING_LIST_MARK = "list:";

    /** Map-string start brace. */
    public static final String MAP_STRING_START_BRACE = "${database.extractAcceptStartBrace}";

    /** Map-string end brace. */
    public static final String MAP_STRING_END_BRACE = "${database.extractAcceptEndBrace}";

    /** Map-string delimiter. */
    public static final String MAP_STRING_DELIMITER = "${database.extractAcceptDelimiter}";

    /** Map-string equal. */
    public static final String MAP_STRING_EQUAL = "${database.extractAcceptEqual}";

    // ===================================================================================
    //                                                                          Table Info
    //                                                                          ==========
    /**
     * Get table DB name.
     * @return Table DB name. (NotNull)
     */
    public String getTableDbName();

    /**
     * Get table property name(JavaBeansRule).
     * @return Table property name(JavaBeansRule). (NotNull)
     */
    public String getTablePropertyName();

    /**
     * Get table SQL name.
     * @return Table SQL name. (NotNull)
     */
    public String getTableSqlName();

    // ===================================================================================
    //                                                                       Name Handling
    //                                                                       =============
    /**
     * Has object of flexible name? {Target objects are TABLE and COLUMN}
     * @param flexibleName The flexible name. (NotNull and NotEmpty)
     * @return Determination.
     */
    public boolean hasFlexibleName(String flexibleName);

    /**
     * Find DB name by flexible name. {Target objects are TABLE and COLUMN}
     * @param flexibleName The flexible name. (NotNull and NotEmpty)
     * @return The DB name of anything. (NotNull and NotEmpty)
     */
    public String findDbName(String flexibleName);

    /**
     * Find property name(JavaBeansRule) by flexible name. {Target objects are TABLE and COLUMN}
     * @param flexibleName The flexible name. (NotNull and NotEmpty)
     * @return The DB name of anything. (NotNull and NotEmpty)
     */
    public String findPropertyName(String flexibleName);
#if ($database.isMakeRecentlyDeprecated())

    // ===================================================================================
    //                                                                            Name Map
    //                                                                            ========
    /**
     * Get the key-to-lower map of DB name(lower) and property name.
     * @return The key-to-lower map of DB name(lower) and property name. (NotNull)
     * @deprecated Sorry! This method is unnecessary on DBFlute.
     */
    public Map<String, String> getDbNamePropertyNameKeyToLowerMap();

    /**
     * Get the key-to-lower map of property name(lower) and DB name.
     * @return The key-to-lower map of property name(lower) and DB name. (NotNull)
     * @deprecated Sorry! This method is unnecessary on DBFlute.
     */
    public Map<String, String> getPropertyNameDbNameKeyToLowerMap();
#end

    // ===================================================================================
    //                                                                           Type Name
    //                                                                           =========
    /**
     * Get the type name of entity.
     * @return The type name of entity. (NotNull)
     */ 
    public String getEntityTypeName();

    /**
     * Get the type name of condition-bean.
     * @return The type name of condition-bean. (Nullable: If the condition-bean does not exist)
     */ 
    public String getConditionBeanTypeName();

    /**
     * Get the type name of DAO.
     * @return The type name of DAO. (Nullable: If the DAO does not exist)
     */ 
    public String getDaoTypeName();

    /**
     * Get the type name of behavior.
     * @return The type name of behavior. (Nullable: If the behavior does not exist)
     */ 
    public String getBehaviorTypeName();

    // ===================================================================================
    //                                                                         Object Type
    //                                                                         ===========
    /**
     * Get the type of entity.
     * @return The type of entity. (NotNull)
     */ 
    public Class<? extends ${glEntityInterfaceName}> getEntityType();

    // ===================================================================================
    //                                                                     Object Instance
    //                                                                     ===============
    /**
     * New the instance of entity.
     * @return The instance of entity. (NotNull)
     */ 
    public ${glEntityInterfaceName} newEntity();

    // ===================================================================================
    //                                                                         Column Info
    //                                                                         ===========
    /**
     * @return The list of DB name of column. (NotNull and NotEmpty)
     */
    public List<${glColumnInfoName}> getColumnInfoList();

    /**
     * Has column?
     * @param columnFlexibleName The flexible name of the column. (NotNull)
     * @return Determination.
     */
    public boolean hasColumn(String columnFlexibleName);

    /**
     * Find the information of the column by the flexible name of the column.
     * <pre>
     * If the table name is 'BOOK_ID', you can find the dbmeta by ...(as follows)
     *     'BOOK_ID', 'BOok_iD', 'book_id'
     *     , 'BookId', 'bookid', 'bOoKiD'
     * </pre>
     * @param columnFlexibleName The flexible name of the column. (NotNull)
     * @return The information of the column. (NotNull)
     */ 
    public ${glColumnInfoName} findColumnInfo(String columnFlexibleName);

    // ===================================================================================
    //                                                                         Unique Info
    //                                                                         ===========
    /**
     * Get primary unique info.
     * @return Primary unique info. (NotNull)
     */
    public ${glUniqueInfoName} getPrimaryUniqueInfo();

    /**
     * Has primary-key?
     * @return Determination.
     */
    public boolean hasPrimaryKey();

    /**
     * Has two or more primary-keys?
     * @return Determination.
     */
    public boolean hasTwoOrMorePrimaryKeys();

    // ===================================================================================
    //                                                                       Relation Info
    //                                                                       =============
    // -----------------------------------------------------
    //                                      Relation Element
    //                                      ----------------
    /**
     * Find relation info.
     * @param relationPropertyName Relation property name. (Both OK - InitCap or not). (NotNull)
     * @return Relation info. (NotNull)
     */ 
    public ${glRelationInfoName} findRelationInfo(String relationPropertyName);

    // -----------------------------------------------------
    //                                       Foreign Element
    //                                       ---------------
    /**
     * Has foreign?
     * @param foreignPropName Foreign property name. (Both OK - InitCap or not). (NotNull)
     * @return Determination. (NotNull)
     */ 
    public boolean hasForeign(String foreignPropName);

    /**
     * Find foreign dbmeta.
     * @param foreignPropName Foreign property name. (Both OK - InitCap or not). (NotNull)
     * @return Foreign DBMeta. (NotNull)
     */ 
    public ${myClassName} findForeignDBMeta(String foreignPropName);

    /**
     * Find foreign info.
     * @param foreignPropName Foreign property name. (Both OK - InitCap or not). (NotNull)
     * @return Foreign info. (NotNull)
     */ 
    public ${glForeignInfoName} findForeignInfo(String foreignPropName);

    // -----------------------------------------------------
    //                                      Referrer Element
    //                                      ----------------
    /**
     * Has referrer?
     * @param referrerPropertyName The property name of referrer. (Both OK - InitCap or not). (NotNull)
     * @return Determination. (NotNull)
     */ 
    public boolean hasReferrer(String referrerPropertyName);

    /**
     * Find referrer dbmeta.
     * @param referrerPropertyName The property name of referrer. (Both OK - InitCap or not). (NotNull)
     * @return Referrer DBMeta. (NotNull)
     */ 
    public ${myClassName} findReferrerDBMeta(String referrerPropertyName);

    /**
     * Find referrer information.
     * @param referrerPropertyName The property name of referrer. (Both OK - InitCap or not). (NotNull)
     * @return Referrer information. (NotNull)
     */ 
    public ${glReferrerInfoName} findReferrerInfo(String referrerPropertyName);

    // -----------------------------------------------------
    //                                        Relation Trace
    //                                        --------------
    /**
     * Relation trace.
     */
    public static interface RelationTrace {

        /**
         * Get the trace of relation.
         * @return The trace of relation as the list of relation info. (NotNull)
         */
        public List${database.filterGenericsString($glRelationInfoName)} getTraceRelation();

        /**
         * Get the trace of column.
         * @return The trace of column as column info. (Nullable)
         */
        public ${glColumnInfoName} getTraceColumn();
    }

    public static interface RelationTraceFixHandler {
        public void handleFixedTrace(RelationTrace relationTrace);
    }


    // ===================================================================================
    //                                                                       Sequence Info
    //                                                                       =============
    /**
     * Has sequence?
     * @return Determination.
     */
    public boolean hasSequence();

    /**
     * Get the SQL string for getting next value of sequence.
     * @return The SQL string for getting next value of sequence. (Nullable: If it does not have sequence, returns null.)
     */
    public String getSequenceNextValSql();

    // ===================================================================================
    //                                                                Optimistic Lock Info
    //                                                                ====================
    /**
     * Has version no?
     * @return Determination.
     */
    public boolean hasVersionNo();

    /**
     * Get the column information of version no.
     * @return The column information of version no. (Nullable: If it doesn't have the column, return null.)
     */
    public ${glColumnInfoName} getVersionNoColumnInfo();

    /**
     * Has update date?
     * @return Determination.
     */
    public boolean hasUpdateDate();

    /**
     * Get the column information of update date.
     * @return The column information of update date. (Nullable: If it doesn't have the column, return null.)
     */
    public ${glColumnInfoName} getUpdateDateColumnInfo();

    // ===================================================================================
    //                                                                  Common Column Info
    //                                                                  ==================
    /**
     * Has common column?
     * @return Determination.
     */
    public boolean hasCommonColumn();

    // ===================================================================================
    //                                                                     Entity Handling
    //                                                                     ===============
    // -----------------------------------------------------
    //                                                Accept
    //                                                ------
    /**
     * Accept primary-key map.
     * The column that column-value map-string doesn't have the value of is reflected as null.
     * The column that column-value map-string doesn't have the key of is NOT updated nothing.
     * @param entity Target entity. (NotNull)
     * @param primaryKeyMap Primary-key map. (NotNull and NotEmpty)
     */
    public void acceptPrimaryKeyMap(${glEntityInterfaceName} entity, Map<String, ? extends Object> primaryKeyMap);

    /**
     * Accept primary-key map-string.
     * The column that column-value map-string doesn't have the value of is reflected as null.
     * The column that column-value map-string doesn't have the key of is NOT updated nothing.
     * @param entity Target entity. (NotNull)
     * @param primaryKeyMapString Primary-key map-string. (NotNull)
     */
    public void acceptPrimaryKeyMapString(${glEntityInterfaceName} entity, String primaryKeyMapString);

    /**
     * Accept column-value map.
     * The column that column-value map-string doesn't have the value of is reflected as null.
     * The column that column-value map-string doesn't have the key of is NOT updated nothing.
     * @param entity Target entity. (NotNull)
     * @param columnValueMap Column-value map. (NotNull and NotEmpty)
     */
    public void acceptColumnValueMap(${glEntityInterfaceName} entity, Map<String, ? extends Object> columnValueMap);

    /**
     * Accept column-value map-string.
     * The column that column-value map-string doesn't have the value of is reflected as null.
     * The column that column-value map-string doesn't have the key of is NOT updated nothing.
     * @param entity Target entity. (NotNull)
     * @param columnValueMapString Column-value map-string. (NotNull)
     */
    public void acceptColumnValueMapString(${glEntityInterfaceName} entity, String columnValueMapString);

    // -----------------------------------------------------
    //                                               Extract
    //                                               -------
    /**
     * Extract primary-key map-string. Delimiter is at-mark and semicolon.
     * <p>
     * <pre>
     * ex) Uses that this method have.
     *   final String primaryKeyMapString = LdBookDbm.extractPrimaryKeyMapString(entity);
     *   final LdBook entity = dao.selectEntity(new LdBookCB().acceptPrimaryKeyMapString(primaryKeyMapString));
     *   ... // as primary key for condition.
     * </pre>
     * 
     * @param entity Target entity. (NotNull)
     * @return Primary-key map-string. (NotNull)
     */
    public String extractPrimaryKeyMapString(${glEntityInterfaceName} entity);

    /**
     * Extract primary-key map-string.
     * @param entity Target entity. (NotNull)
     * @param startBrace Start-brace. (NotNull)
     * @param endBrace End-brace. (NotNull)
     * @param delimiter Delimiter. (NotNull)
     * @param equal Equal. (NotNull)
     * @return Primary-key map-string. (NotNull)
     */
    public String extractPrimaryKeyMapString(${glEntityInterfaceName} entity, String startBrace, String endBrace, String delimiter, String equal);

    /**
     * Extract column-value map-string. Delimiter is at-mark and semicolon.
     * @param entity Target entity. (NotNull)
     * @return Column-value map-string. (NotNull)
     */
    public String extractColumnValueMapString(${glEntityInterfaceName} entity);

    /**
     * Extract column-value map-string.
     * @param entity Target entity. (NotNull)
     * @param startBrace Start-brace. (NotNull)
     * @param endBrace End-brace. (NotNull)
     * @param delimiter Delimiter. (NotNull)
     * @param equal Equal. (NotNull)
     * @return Column-value map-string. (NotNull)
     */
    public String extractColumnValueMapString(${glEntityInterfaceName} entity, String startBrace, String endBrace, String delimiter, String equal);

    // -----------------------------------------------------
    //                                               Convert
    //                                               -------
    /**
     * Convert entity to column value as list.
     * @param entity Target entity. (NotNull)
     * @return The list of column value. (NotNull)
     */
    public List<Object> convertToColumnValueList(${glEntityInterfaceName} entity);

    /**
     * Convert entity to column value as map.
     * @param entity Target entity. (NotNull)
     * @return The map of column value. (NotNull)
     */
    public Map<String, Object> convertToColumnValueMap(${glEntityInterfaceName} entity);

    /**
     * Convert entity to column string-value as list.
     * @param entity Target entity. (NotNull)
     * @return The list of column string-value. (NotNull)
     */
    public List<String> convertToColumnStringValueList(${glEntityInterfaceName} entity);

    /**
     * Convert entity to column string-value as map.
     * @param entity Target entity. (NotNull)
     * @return The map of column string-value. (NotNull)
     */
    public Map<String, String> convertToColumnStringValueMap(${glEntityInterfaceName} entity);

    // ===================================================================================
    //                                                                          Map String
    //                                                                          ==========
    /**
     * Create map list string that is prepared. (for INTERNAL)
     * @return Map list string that is prepared. (NotNull)
     */
    public ${glMapListStringName} createMapListString();

    /**
     * Create map string builder that is prepared. (for INTERNAL)
     * @return Map string builder that is prepared. (NotNull)
     */
    public ${glMapStringBuilderName} createMapStringBuilder();
    
    // ===================================================================================
    //                                                               Entity Property Setup
    //                                                               =====================
    // It's very INTERNAL!
    /**
     * Has the setupper of entity property by the name of property? <br />
     * Comparing is so flexible. {Ignore cases and underscore}
     * @param propertyName The name of the property. (NotNull)
     * @return Determination.
     */
     public boolean hasEntityPropertySetupper(String propertyName);
     
    /**
     * Set up entity property. (for INTERNAL)
     * @param propertyName The name of the property. (NotNull)
     * @param entity The entity for the property. (NotNull)
     * @param value The value of the property. (Nullable)
     */
    public void setupEntityProperty(String propertyName, Object entity, Object value);
    
    /**
     * The setupper of entity property. <br />
     * This class is for Internal. Don't use this!
     * @param <ENTITY_TYPE> The type of entity.
     */
    public interface Eps<ENTITY_TYPE extends ${glEntityInterfaceName}> {
        
        /**
         * @param entity Entity. (NotNull)
         * @param value Value. (Nullable)
         */
        void setup(ENTITY_TYPE entity, Object value);
    }

    // ===================================================================================
    //                                                                Optimistic Lock Type
    //                                                                ====================
    public static enum OptimisticLockType {
        NONE, VERSION_NO, UPDATE_DATE
    }
}
